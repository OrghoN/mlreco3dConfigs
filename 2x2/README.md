
# 2x2 Configuration files

these are the set of configuration files designed to train and validate [lartpc_mlreco3d](
The configuration files without val in the filename are for training whereas the ones that do contain val in the filename are meant for validation and are to be run when you already have a set of weights that may be generated by running the training configurations.

A more detailed tutorial for the lartpc_mlreco3d package may be found [here](https://www.deeplearnphysics.org/lartpc_mlreco3d_tutorials/index.html). Although this tutorial may be a little outdated , the concepts expressed therein are still valid even if the technical details of the configuration has changed.

The configuration files provided in this directory are meant for training and validating the various stages of the reconstruction chain independently. 
They are designed for version 2.8.4 of lartpc_mlreco3d and use simulation files generated by kazu located on the s3df cluster at SLAC. 

The simulation files may be found in the directory:

```bash
/sdf/data/neutrino/kterao/dunend_train_prod/prod2x2_v0_1_larnd2supera/combined/
```

The file that the configuration files train on are located at

```bash
/sdf/data/neutrino/kterao/dunend_train_prod/prod2x2_v0_1_larnd2supera/combined/train.root
```

The files for validation are located at 

```bash
/sdf/data/neutrino/kterao/dunend_train_prod/prod2x2_v0_1_larnd2supera/combined/test.root
```

The shell scripts are meant to submit batch jobs to SLEARN for training and validation .
The shell scripts assume that your account has access to the neutrino account for running jobs and therefore can access the ampere partition. 

# Quickstart

This quickstart guide is meant to get you started in running these configurations and as such is quite prescriptive
. These files cam definitely be used in ways that integrate into your current workflow.
However, they nay beed to be edited for that to work and this quickstart guide does not go into how to do that since everyones workflow nay be different.

Furthermore, this guide assumes that you already have access to both an s3df account and that your account is authorized to use the neutrino account when submitting batch jobs.

## Accessing s3df

For running these jobs, s3df can be logged into using ssh in the following way:

```bash
ssh <Username>@s3dflogin.slac.stanford.edu
ssh neutrino
```

where `<Username>` in the previous command is meant to be replaced with your s3df username. 

## Setting up a working area 

It is a good idea to have these files running from a working area rather than from your home directory directly. 
A good place to set up your working are is in 

```bash
/sdf/group/neutrino/<Username>
```

The shell scripts require environmental variables `$APP_DIR` that points to your working area.
if you already have one that you would  like to use, then set the variable `$APP_DIR` to point to that directory. otherwise, you can create the reccomended area using 

```bash
export APP_DIR=/sdf/group/neutrino/$USER
mkdir $APP_DIR
cd $APP_DIR
```

## Getting the scripts

Next step is to clone this repository. If you have git set up with ssh and want to use the ssh version of this repository, it can be cloned with 

```bash
git clone git@github.com:OrghoN/mlreco3dConfigs.git
```

If you dont have ssh set up with github or just want to use the https url, you can clone it with 

```bash
git clone https://github.com/OrghoN/mlreco3dConfigs.git
```

## lartpc_mlreco3d

Next step is to get lartpc_mlreco3d. 
If you already have this you can point the environmental variable `$MLRECO3D_PATH` to that installation directory.

Otherwise we can get it with 

```bash
git clone git@github.com:DeepLearnPhysics/lartpc_mlreco3d.git
```

for the ssh version of this directory and 

```bash
git clone https://github.com/DeepLearnPhysics/lartpc_mlreco3d.git
```

for the https version.

we can point the environmental variable `$MLRECO3D_PATH` to this repo by 

```bash
export MLRECO3D_PATH=$APP_DIR/lartpc_mlreco3d
```

These environmental variables need to be set every time a job is run with these scripts. To not have to type in the export commandsd each time, you can put those export lines in yuour .bashrc or equivalent.

Depending on how far the latest version of lartpc_mlreco3d is, you may need to change the version to 2.8.4 which can be done in this way.

```bash
cd $MLRECO3D_PATH
git checkout -v 2.8.4
```

## Submitting jobs

Jobs can be submitted in the following way.

```bash
cd $APP_DIR/mlreco3dConfigs/2x2
sbatch <filename>.sh
```

Where the `<filename>` is to be replaced with the file you actually want to run.

#### SLEARN job management

The status of running jobs  can be checked with

```bash
squeue --me
```

Jobs can be cancelled manually with

```bash
scancel <JobId>
```

Where `<JobId>` is to be replaced with the actual id that you can get from running the command to get job status.

